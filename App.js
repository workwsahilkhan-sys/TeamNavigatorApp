import React, { useState, useEffect } from 'react';\nimport { StyleSheet, View, Text, TouchableOpacity, FlatList, TextInput, Button } from 'react-native';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { createStackNavigator } from '@react-navigation/stack';\nimport MapView, { Marker } from 'react-native-maps';\nimport * as Location from 'expo-location';\nimport { Magnetometer } from 'expo-sensors';\nimport { GiftedChat } from 'react-native-gifted-chat';\n\nconst Stack = createStackNavigator();\n\nfunction MapScreen({ navigation }) {\n  const [location, setLocation] = useState(null);\n  const [heading, setHeading] = useState(0);\n  const [elevation, setElevation] = useState(0);\n  const [waypoints, setWaypoints] = useState([]);\n  const [teammates, setTeammates] = useState([{ id: '1', name: 'Teammate1', callsign: 'Alpha', lat: 37.78825, lon: -122.4324 }]);\n\n  useEffect(() => {\n    (async () => {\n      let { status } = await Location.requestForegroundPermissionsAsync();\n      if (status !== 'granted') {\n        alert('Permission to access location was denied');\n        return;\n      }\n\n      let loc = await Location.getCurrentPositionAsync({});\n      setLocation(loc);\n      setElevation(loc.coords.altitude);\n    })();\n\n    Magnetometer.addListener((data) => {\n      let angle = Math.atan2(data.y, data.x) * (180 / Math.PI);\n      setHeading(angle);\n    });\n    Magnetometer.setUpdateInterval(100);\n\n    return () => {\n      Magnetometer.removeAllListeners();\n    };\n  }, []);\n\n  const addWaypoint = (e) => {\n    const { coordinate } = e.nativeEvent;\n    setWaypoints([...waypoints, { id: Date.now().toString(), ...coordinate }]);\n  };\n\n  return (\n    <View style={styles.container}>\n      <MapView\n        style={styles.map}\n        initialRegion={{\n          latitude: location ? location.coords.latitude : 37.78825,\n          longitude: location ? location.coords.longitude : -122.4324,\n          latitudeDelta: 0.0922,\n          longitudeDelta: 0.0421,\n        }}\n        showsUserLocation={true}\n        showsCompass={true}\n        onLongPress={addWaypoint}\n      >\n        {location && (\n          <Marker\n            coordinate={{\n              latitude: location.coords.latitude,\n              longitude: location.coords.longitude,\n            }}\n            title=\"You\"\n          />\n        )}\n        {waypoints.map((wp) => (\n          <Marker key={wp.id} coordinate={wp} title=\"Waypoint\" />\n        ))}\n        {teammates.map((tm) => (\n          <Marker key={tm.id} coordinate={{ latitude: tm.lat, longitude: tm.lon }} title={tm.callsign} />\n        ))}\n      </MapView>\n      <View style={styles.overlay}>\n        <Text>Lat: {location ? location.coords.latitude.toFixed(6) : 'Loading'}</Text>\n        <Text>Lon: {location ? location.coords.longitude.toFixed(6) : 'Loading'}</Text>\n        <Text>Heading: {heading.toFixed(0)}Â°</Text>\n        <Text>Elevation: {elevation.toFixed(0)}m</Text>\n      </View>\n      <View style={styles.navButtons}>\n        <TouchableOpacity style={styles.button} onPress={() => navigation.navigate('Teammates')}>\n          <Text>Teammates</Text>\n        </TouchableOpacity>\n        <TouchableOpacity style={styles.button} onPress={() => navigation.navigate('Chat')}>\n          <Text>Chat</Text>\n        </TouchableOpacity>\n      </View>\n    </View>\n  );\n}\n\nfunction TeammatesScreen({ navigation }) {\n  const [teammates, setTeammates] = useState([{ id: '1', name: 'Teammate1', callsign: 'Alpha', group: 'Group1' }]);\n  const [newTeammate, setNewTeammate] = useState({ name: '', callsign: '', group: '' });\n\n  const addTeammate = () => {\n    if (newTeammate.name && newTeammate.callsign) {\n      setTeammates([...teammates, { ...newTeammate, id: Date.now().toString() }]);\n      setNewTeammate({ name: '', callsign: '', group: '' });\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <Text style={styles.title}>Teammates</Text>\n      <FlatList\n        data={teammates}\n        keyExtractor={(item) => item.id}\n        renderItem={({ item }) => (\n          <View style={styles.teammateItem}>\n            <Text>{item.name} ({item.callsign}) - {item.group}</Text>\n          </View>\n        )}\n      />\n      <TextInput\n        placeholder=\"Name\"\n        value={newTeammate.name}\n        onChangeText={(text) => setNewTeammate({ ...newTeammate, name: text })}\n        style={styles.input}\n      />\n      <TextInput\n        placeholder=\"Callsign\"\n        value={newTeammate.callsign}\n        onChangeText={(text) => setNewTeammate({ ...newTeammate, callsign: text })}\n        style={styles.input}\n      />\n      <TextInput\n        placeholder=\"Group\"\n        value={newTeammate.group}\n        onChangeText={(text) => setNewTeammate({ ...newTeammate, group: text })}\n        style={styles.input}\n      />\n      <Button title=\"Add Teammate\" onPress={addTeammate} />\n      <TouchableOpacity style={styles.button} onPress={() => navigation.goBack()}>\n        <Text>Back to Map</Text>\n      </TouchableOpacity>\n    </View>\n  );\n}\n\nfunction ChatScreen({ navigation }) {\n  const [messages, setMessages] = useState([\n    {\n      _id: 1,\n      text: 'Hello!',\n      createdAt: new Date(),\n      user: {\n        _id: 2,\n        name: 'Teammate',\n      },\n    },\n  ]);\n\n  const onSend = (messages = []) => {\n    setMessages(previousMessages => GiftedChat.append(previousMessages, messages));\n  };\n\n  return (\n    <View style={styles.container}>\n      <GiftedChat\n        messages={messages}\n        onSend={onSend}\n        user={{\n          _id: 1,\n        }}\n      />\n      <TouchableOpacity style={styles.button} onPress={() => navigation.goBack()}>\n        <Text>Back to Map</Text>\n      </TouchableOpacity>\n    </View>\n  );\n}\n\nexport default function App() {\n  return (\n    <NavigationContainer>\n      <Stack.Navigator initialRouteName=\"Map\">\n        <Stack.Screen name=\"Map\" component={MapScreen} />\n        <Stack.Screen name=\"Teammates\" component={TeammatesScreen} />\n        <Stack.Screen name=\"Chat\" component={ChatScreen} />\n      </Stack.Navigator>\n    </NavigationContainer>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  map: {\n    width: '100%',\n    height: '100%',\n  },\n  overlay: {\n    position: 'absolute',\n    top: 50,\n    left: 10,\n    backgroundColor: 'rgba(255,255,255,0.8)',\n    padding: 10,\n    borderRadius: 5,\n  },\n  navButtons: {\n    position: 'absolute',\n    bottom: 20,\n    left: 10,\n    right: 10,\n    flexDirection: 'row',\n    justifyContent: 'space-around',\n  },\n  button: {\n    backgroundColor: '#ddd',\n    padding: 10,\n    borderRadius: 5,\n  },\n  title: {\n    fontSize: 24,\n    textAlign: 'center',\n    margin: 10,\n  },\n  teammateItem: {\n    padding: 10,\n    borderBottomWidth: 1,\n    borderBottomColor: '#ccc',\n  },\n  input: {\n    borderWidth: 1,\n    borderColor: '#ccc',\n    padding: 10,\n    margin: 10,\n  },\n});\n